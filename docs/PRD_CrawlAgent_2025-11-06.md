# CrawlAgent ê°œì¸ í”„ë¡œì íŠ¸ PRD

## Goal

**ë²”ìš© Self-Healing Multi-Agent ë°ì´í„° ìˆ˜ì§‘ ì‹œìŠ¤í…œ**

ë‰´ìŠ¤, SNS, ë¸”ë¡œê·¸ ë“± ë‹¤ì–‘í•œ ì›¹ ì†ŒìŠ¤ì˜ HTML êµ¬ì¡° ë³€ê²½ì— ìžë™ìœ¼ë¡œ ëŒ€ì‘í•˜ëŠ” ë²”ìš© ë©€í‹° ì—ì´ì „íŠ¸ í¬ë¡¤ëŸ¬ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì—¬, ë°ì´í„° ë¶„ì„ê°€/PM/ë¹„ì¦ˆë‹ˆìŠ¤ íŒ€ì´ ìžì—°ì–´ë¡œ ìš”ì²­í•˜ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ë™ ìœ ì§€ë³´ìˆ˜ ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ì œê³µí•œë‹¤.

### Core Use Cases

1. **ë²”ìš© ë°ì´í„° ìˆ˜ì§‘ ë° í’ˆì§ˆ ê²€ì¦ (News, SNS, Blog)**
   - **ë‰´ìŠ¤**: ì—°í•©ë‰´ìŠ¤, BBC, CNN ë“± ì£¼ìš” ì–¸ë¡ ì‚¬ ê¸°ì‚¬ ìžë™ ìˆ˜ì§‘
   - **SNS**: íŠ¸ìœ„í„°, íŽ˜ì´ìŠ¤ë¶, ì¸ìŠ¤íƒ€ê·¸ëž¨ ê²Œì‹œë¬¼ ë° ë™ì  ë©”íŠ¸ë¦­(ì¢‹ì•„ìš”, ëŒ“ê¸€) ìˆ˜ì§‘
   - **ë¸”ë¡œê·¸**: Medium, ë„¤ì´ë²„ ë¸”ë¡œê·¸ ë“± ì»¨í…ì¸  ì¶”ì¶œ
   - GPT-4o-mini ê¸°ë°˜ í’ˆì§ˆ ê²Œì´íŠ¸ë¥¼ í†µí•´ 95ì  ì´ìƒ ë°ì´í„°ë§Œ ì €ìž¥
   - ë¶ˆì™„ì „í•œ ì¶”ì¶œ ìžë™ íƒì§€ ë° ìž¬ì²˜ë¦¬

2. **ì¦ë¶„ ìˆ˜ì§‘ ì „ëžµ (ë‚ ì§œ ê¸°ë°˜ ìžë™ ì¤‘ë‹¨)**
   - **ë‰´ìŠ¤**: 11ì›” 2ì¼ ê²½ì œ ì¹´í…Œê³ ë¦¬ ìˆ˜ì§‘ ì¤‘ 11ì›” 3ì¼ìž ê¸°ì‚¬ ê²Œì‹œ ê°ì§€ ì‹œ ìžë™ ì¤‘ë‹¨
   - **SNS**: ì£¼ê¸°ì  í¬ë¡¤ë§ìœ¼ë¡œ ì¢‹ì•„ìš”/ëŒ“ê¸€ ìˆ˜ ë“± ë™ì  ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
   - URL ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€ (PostgreSQL UNIQUE ì œì•½ì¡°ê±´)
   - ë§¤ì¼ ìžë™ ì‹¤í–‰ ìŠ¤ì¼€ì¤„ë§ (cron/APScheduler)

3. **HTML êµ¬ì¡° ë³€ê²½ ê°ì§€ ë° ìžë™ ë³µêµ¬**
   - CSS Selector íŒŒì‹± ì‹¤íŒ¨ ì‹œ ìžë™ ê°ì§€
   - Multi-Agent ì‹œìŠ¤í…œ(GPT + Gemini)ì„ í†µí•œ ìƒˆë¡œìš´ Selector ìžë™ ìƒì„±
   - HITL(Human-in-the-Loop)ì„ í†µí•œ ìµœì¢… ê²€ì¦ ë° ìŠ¹ì¸

4. **Multi-Agent í•©ì˜ ê¸°ë°˜ ë°ì´í„° ì¶”ì¶œ**
   - GPT-4o-mini: CSS Selector ì œì•ˆ (Proposer)
   - Gemini-2.0-flash: ì‹¤ì œ HTML í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (Validator)
   - 2/3 í•„ë“œ ì´ìƒ ì¶”ì¶œ ì„±ê³µ ì‹œ ìžë™ í•©ì˜
   - 3íšŒ ìž¬ì‹œë„ ì‹¤íŒ¨ ì‹œ Human Review ìš”ì²­

5. **ìžì—°ì–´ ì¿¼ë¦¬ ì¸í„°íŽ˜ì´ìŠ¤ (í–¥í›„ í™•ìž¥)**
   - Data Analyst, PM, Business íŒ€ì´ ìžì—°ì–´ë¡œ ë°ì´í„° ìš”ì²­
   - ì˜ˆ: "ìµœê·¼ 1ì£¼ì¼ê°„ ê²½ì œ ë‰´ìŠ¤ ì¤‘ 'AI' í‚¤ì›Œë“œ í¬í•¨ ê¸°ì‚¬ ìš”ì•½"
   - LLM ê¸°ë°˜ Context Engineeringìœ¼ë¡œ ìµœì  ë°ì´í„°ì…‹ ê²€ìƒ‰ ë° ì œê³µ

---

## Problem Statement

### 1. ê¸°ì¡´ í¬ë¡¤ëŸ¬ì˜ ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´ ë° í™•ìž¥ì„± í•œê³„
- **ìˆ˜ë™ ìœ ì§€ë³´ìˆ˜**: ë‰´ìŠ¤/SNS/ë¸”ë¡œê·¸ ì‚¬ì´íŠ¸ê°€ HTML êµ¬ì¡°ë¥¼ ë³€ê²½í•  ë•Œë§ˆë‹¤ CSS Selector ìˆ˜ë™ ìˆ˜ì •
- **ì‚¬ì´íŠ¸ë³„ ì»¤ìŠ¤í…€ ì½”ë“œ**: ê° ì†ŒìŠ¤(ì—°í•©ë‰´ìŠ¤, íŠ¸ìœ„í„°, ë„¤ì´ë²„ ë¸”ë¡œê·¸)ë§ˆë‹¤ ë³„ë„ Spider ìž‘ì„±
- **í™•ìž¥ì„± ë¶€ì¡±**: ìƒˆë¡œìš´ ë°ì´í„° ì†ŒìŠ¤ ì¶”ê°€ ì‹œ ì²˜ìŒë¶€í„° ê°œë°œ í•„ìš”
- ìœ ì§€ë³´ìˆ˜ ì‹œê°„ ì†Œìš”: í‰ê·  30ë¶„~1ì‹œê°„/ì‚¬ì´íŠ¸ ë³€ê²½

### 2. ë¶ˆì™„ì „í•œ ë°ì´í„° ì¶”ì¶œì˜ ë¬´ë¶„ë³„í•œ ì €ìž¥
- ê¸°ì¡´ í¬ë¡¤ëŸ¬ëŠ” ì¶”ì¶œ ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ì§€ ëª»í•¨
- ë¹ˆ ë¬¸ìžì—´, ìž˜ëª»ëœ í•„ë“œ ë§¤í•‘ ë“±ì´ DBì— ê·¸ëŒ€ë¡œ ì €ìž¥
- ë°ì´í„° í’ˆì§ˆ ë¬¸ì œë¡œ ì¸í•œ í›„ì† ì²˜ë¦¬ ì˜¤ë¥˜ ë°œìƒ
- ë¶„ì„íŒ€/ë¹„ì¦ˆë‹ˆìŠ¤íŒ€ì— ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ë°ì´í„° ì œê³µ

### 3. ë‹¨ì¼ ëª¨ë¸ ê¸°ë°˜ íŒë‹¨ì˜ í•œê³„
- ë‹¨ì¼ LLMë§Œ ì‚¬ìš©í•  ê²½ìš° íŽ¸í–¥(bias) ê°€ëŠ¥ì„±
- ì¶”ì¶œ ê²°ê³¼ì˜ ì‹ ë¢°ë„ ê²€ì¦ ë¶€ì¡±
- ìž˜ëª»ëœ CSS Selectorë¥¼ ìžì‹ ìžˆê²Œ ì œì•ˆí•˜ëŠ” hallucination ë¬¸ì œ

### 4. ë¹„íš¨ìœ¨ì ì¸ ìˆ˜ì§‘ ì „ëžµ
- **ë¬´ë¶„ë³„í•œ ì „ì²´ í¬ë¡¤ë§**: íŽ˜ì´ì§€ë³„/ì¹´í…Œê³ ë¦¬ë³„ ìˆ˜ì§‘ìœ¼ë¡œ ì¤‘ë³µ ë° ì‹œê°„ ë‚­ë¹„
- **ë™ì  ë°ì´í„° ë¯¸ì§€ì›**: SNSì˜ ì¢‹ì•„ìš”/ëŒ“ê¸€ ìˆ˜ ë“± ì‹œê°„ì— ë”°ë¼ ë³€í•˜ëŠ” ë©”íŠ¸ë¦­ ì¶”ì  ë¶ˆê°€
- **ë‚ ì§œ ê¸°ë°˜ ì¤‘ë‹¨ ì—†ìŒ**: ìƒˆë¡œìš´ ë‚ ì§œ ë°ì´í„° ì¶œí˜„ ì‹œ ìžë™ ì¤‘ë‹¨ ë©”ì»¤ë‹ˆì¦˜ ë¶€ìž¬

---

## Key Features

### Feature 1: UC1 - GPT ê¸°ë°˜ í’ˆì§ˆ ê²Œì´íŠ¸ (Quality Gate)

**ì„¤ëª…**: ëª¨ë“  ì¶”ì¶œ ê²°ê³¼ë¥¼ GPT-4o-miniê°€ ê²€ì¦í•˜ì—¬ 95ì  ì´ìƒ ê¸°ì‚¬ë§Œ ì €ìž¥

**ê¸°ìˆ  êµ¬í˜„**:
- ê°„ë‹¨í•œ Python í•¨ìˆ˜ë¡œ êµ¬í˜„ (LangGraph ë¯¸ì‚¬ìš©)
- ìž…ë ¥: `{title, body, date}` ì¶”ì¶œ ê²°ê³¼
- ì¶œë ¥: `{score: 0-100, is_valid: bool, feedback: str}`
- ìž„ê³„ê°’: `score >= 95` ë§Œ DB ì €ìž¥

**ì½”ë“œ ìœ„ì¹˜**:
- [src/workflow/uc1_validation.py](../src/workflow/uc1_validation.py)
- Scrapy Spiderì—ì„œ `validate_article_with_gpt()` í˜¸ì¶œ

**ìž¥ì **:
- ë¶ˆì™„ì „í•œ ì¶”ì¶œ ìžë™ ì°¨ë‹¨
- HTML êµ¬ì¡° ë³€ê²½ ì¡°ê¸° ê°ì§€ ê°€ëŠ¥ (ì ìˆ˜ ê¸‰ë½ ì‹œ)
- ì¶”ê°€ ì¸í”„ë¼ ë¶ˆí•„ìš” (ë‹¨ìˆœ í•¨ìˆ˜ í˜¸ì¶œ)

---

### Feature 2: UC2 - Multi-Agent CSS Selector ìžë™ ìƒì„±

**ì„¤ëª…**: HTML êµ¬ì¡° ë³€ê²½ ì‹œ GPT + Geminiê°€ í˜‘ë ¥í•˜ì—¬ ìƒˆë¡œìš´ CSS Selectorë¥¼ ìžë™ ìƒì„±

**ì•„í‚¤í…ì²˜**: LangGraph StateGraph ê¸°ë°˜ Multi-Agent HITL ì‹œìŠ¤í…œ

```
START
  â†“
gpt_propose (GPT-4o-mini)
  - HTML ë¶„ì„
  - CSS Selector ì œì•ˆ
  - confidence score í¬í•¨
  â†“
gemini_validate (Gemini-2.0-flash)
  - ì œì•ˆëœ Selectorë¡œ ì‹¤ì œ ì¶”ì¶œ ì‹œë„
  - 2/3 í•„ë“œ ì´ìƒ ì„±ê³µ â†’ í•©ì˜
  - ì‹¤íŒ¨ ì‹œ ìž¬ì‹œë„ (ìµœëŒ€ 3íšŒ)
  â†“
route_after_validation (Routing Function)
  â”œâ”€ END (í•©ì˜ ì„±ê³µ)
  â”œâ”€ retry (gpt_propose ìž¬ì‹¤í–‰)
  â””â”€ human_review (HITL ë°œë™)
       â†“
     END
```

**ì½”ë“œ ìœ„ì¹˜**:
- [src/workflow/uc2_hitl.py](../src/workflow/uc2_hitl.py:122) - gpt_propose_node
- [src/workflow/uc2_hitl.py](../src/workflow/uc2_hitl.py:210) - gemini_validate_node
- [src/workflow/uc2_hitl.py](../src/workflow/uc2_hitl.py:347) - human_review_node
- [src/workflow/uc2_hitl.py](../src/workflow/uc2_hitl.py:405) - build_uc2_graph

**State êµ¬ì¡°** (`HITLState`):
```python
{
  "url": str,                        # í¬ë¡¤ë§ ëŒ€ìƒ URL
  "site_name": str,                  # ì‚¬ì´íŠ¸ ì´ë¦„
  "html_content": str,               # ì›ë³¸ HTML
  "gpt_proposal": dict,              # GPT ì œì•ˆ Selector
  "gemini_validation": dict,         # Gemini ê²€ì¦ ê²°ê³¼
  "consensus_reached": bool,         # í•©ì˜ ì—¬ë¶€
  "retry_count": int,                # ìž¬ì‹œë„ íšŸìˆ˜
  "final_selectors": dict,           # ìµœì¢… ìŠ¹ì¸ëœ Selector
  "error_message": Optional[str],
  "next_action": Literal["validate", "retry", "human_review", "end"]
}
```

**í•µì‹¬ ê°œë…**:
- **State**: ëª¨ë“  Nodeê°€ ê³µìœ í•˜ëŠ” ë°ì´í„° (ë¶ˆë³€ì„± ìœ ì§€)
- **Node**: ìž‘ì—… ë‹¨ìœ„ í•¨ìˆ˜ (gpt_propose, gemini_validate, human_review)
- **Edge**: ë…¸ë“œ ê°„ íë¦„ (ì‹¤ì„  = í•­ìƒ ì‹¤í–‰, ì ì„  = ì¡°ê±´ë¶€ ë¶„ê¸°)
- **Routing**: ë¶„ê¸°ì  ê²°ì • í•¨ìˆ˜ (route_after_validation)

**ìž¥ì **:
- GPT + Gemini êµì°¨ ê²€ì¦ìœ¼ë¡œ hallucination ë°©ì§€
- ì‹¤ì œ HTML í…ŒìŠ¤íŠ¸ë¡œ Selector ì •í™•ë„ ë³´ìž¥
- ìžë™ ìž¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ (ìµœëŒ€ 3íšŒ)
- HITLë¡œ ìµœì¢… ì•ˆì „ìž¥ì¹˜ ì œê³µ

---

### Feature 3: LangGraph Studio ì‹œê°í™”

**ì„¤ëª…**: UC2 ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ë””ë²„ê¹…í•  ìˆ˜ ìžˆëŠ” ì›¹ UI

**ê¸°ëŠ¥**:
- StateGraph ì‹œê°í™” (ë…¸ë“œ, ì—£ì§€, ë¼ìš°íŒ… íë¦„)
- ê° ë‹¨ê³„ë³„ State ë³€í™” ì¶”ì 
- ìž…ë ¥ ë°ì´í„° JSON í˜•ì‹ìœ¼ë¡œ ì œê³µ
- Cloudflare Tunnelì„ í†µí•œ HTTPS ì ‘ê·¼

**ì‹¤í–‰ ë°©ë²•**:
```bash
cd /Users/charlee/Desktop/Intern/crawlagent
langgraph dev --tunnel
```

**í…ŒìŠ¤íŠ¸ ìž…ë ¥ ìƒì„±**:
```bash
python scripts/fetch_html_for_studio.py "https://www.yna.co.kr/view/AKR20251105086500009"
# â†’ studio_input.json ìƒì„±
```

**ì‹œê°í™” ìžë£Œ**:
- [docs/uc2_explained.png](./uc2_explained.png) - UC2 StateGraph ë‹¤ì´ì–´ê·¸ëž¨
- [docs/uc1_vs_uc2_comparison.png](./uc1_vs_uc2_comparison.png) - UC1 vs UC2 ë¹„êµí‘œ

---

### Feature 4: Gradio ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

**ì„¤ëª…**: í¬ë¡¤ë§ ì§„í–‰ ìƒí™©, í’ˆì§ˆ ê²€ì¦ ê²°ê³¼, ì—ì´ì „íŠ¸ í™œë™ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‹œê°í™”

**ì£¼ìš” í™”ë©´**:
1. **Dashboard**: ì „ì²´ í†µê³„ (ìˆ˜ì§‘ ê±´ìˆ˜, ì„±ê³µë¥ , í‰ê·  í’ˆì§ˆ ì ìˆ˜)
2. **Recent Articles**: ìµœê·¼ ìˆ˜ì§‘ëœ ê¸°ì‚¬ ëª©ë¡
3. **Quality Monitor**: UC1 ê²€ì¦ ì ìˆ˜ ë¶„í¬
4. **Agent Activity**: UC2 ì‹¤í–‰ ì´ë ¥ ë° í•©ì˜ ì„±ê³µë¥ 
5. **System Logs**: ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¼

**ê¸°ìˆ  ìŠ¤íƒ**:
- Gradio 4.0+ (ì›¹ UI í”„ë ˆìž„ì›Œí¬)
- Plotly (ì°¨íŠ¸ ì‹œê°í™”)
- APScheduler (ì£¼ê¸°ì  í¬ë¡¤ë§)
- PostgreSQL (ë°ì´í„° ì €ìž¥)

---

### Feature 5: ì¦ë¶„ ìˆ˜ì§‘ ì „ëžµ ë° ë‚ ì§œ ê¸°ë°˜ ìžë™ ì¤‘ë‹¨

**ì„¤ëª…**: íš¨ìœ¨ì ì¸ ë°ì´í„° ìˆ˜ì§‘ì„ ìœ„í•œ ì§€ëŠ¥í˜• ì¦ë¶„ ìˆ˜ì§‘ ì‹œìŠ¤í…œ

**ë‰´ìŠ¤ ìˆ˜ì§‘ ì „ëžµ**:
- **ë‚ ì§œ ê¸°ë°˜ ìžë™ ì¤‘ë‹¨**: 11ì›” 2ì¼ ê²½ì œ ì¹´í…Œê³ ë¦¬ ìˆ˜ì§‘ ì¤‘ 11ì›” 3ì¼ìž ê¸°ì‚¬ ì¶œí˜„ ê°ì§€ ì‹œ ìžë™ ì¤‘ë‹¨
- **ë§¤ì¼ ìžë™ ì‹¤í–‰**: cron/APSchedulerë¡œ ë§¤ì¼ 00:00 ì‹¤í–‰
- **URL ì¤‘ë³µ ë°©ì§€**: PostgreSQL UNIQUE ì œì•½ì¡°ê±´ìœ¼ë¡œ ì¤‘ë³µ ì°¨ë‹¨

**SNS ìˆ˜ì§‘ ì „ëžµ**:
- **ì£¼ê¸°ì  ì—…ë°ì´íŠ¸**: ì¢‹ì•„ìš” ìˆ˜, ëŒ“ê¸€ ìˆ˜, ê³µìœ  ìˆ˜ ë“± ë™ì  ë©”íŠ¸ë¦­ ì¶”ì 
- **ì‹œê³„ì—´ ë°ì´í„°**: ê°™ì€ ê²Œì‹œë¬¼ì˜ ë©”íŠ¸ë¦­ ë³€í™”ë¥¼ ì‹œê°„ë³„ë¡œ ì €ìž¥
- **ìŠ¤ì¼€ì¤„**: ë§¤ 6ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰ (00:00, 06:00, 12:00, 18:00)

**êµ¬í˜„ ì„¸ë¶€ì‚¬í•­**:
```python
# ë‰´ìŠ¤: ë‚ ì§œ ê¸°ë°˜ ì¤‘ë‹¨ ë¡œì§
def should_stop_crawling(article_date, target_date):
    if article_date > target_date:
        logger.info(f"ìƒˆë¡œìš´ ë‚ ì§œ {article_date} ê°ì§€ - í¬ë¡¤ë§ ì¤‘ë‹¨")
        return True
    return False

# SNS: ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
def update_social_metrics(post_url, new_metrics):
    # ê¸°ì¡´ ê²Œì‹œë¬¼ì˜ ì¢‹ì•„ìš”/ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
    # ì‹œê³„ì—´ í…Œì´ë¸”ì— ìŠ¤ëƒ…ìƒ· ì €ìž¥
    pass
```

**ìž¥ì **:
- ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€ (ë¹„ìš© ì ˆê°)
- ì¤‘ë³µ ë°ì´í„° ì €ìž¥ ë°©ì§€
- íš¨ìœ¨ì ì¸ ì¦ë¶„ ì—…ë°ì´íŠ¸
- SNS ë™ì  ë©”íŠ¸ë¦­ ì‹œê³„ì—´ ë¶„ì„ ê°€ëŠ¥

---

### Feature 6: í™•ìž¥ ê°€ëŠ¥í•œ ì „ì²˜ë¦¬ ë° ìš”ì•½ ì›Œí¬í”Œë¡œìš° (í–¥í›„ í™•ìž¥)

**ì„¤ëª…**: ë°ì´í„° ìˆ˜ì§‘ í›„ ì „ì²˜ë¦¬ ë° ìš”ì•½ì„ ìœ„í•œ í™•ìž¥ ê°€ëŠ¥í•œ LangGraph ì›Œí¬í”Œë¡œìš°

**Phase 1: ì „ì²˜ë¦¬ (í˜„ìž¬ ë²”ìœ„)**
- HTML íƒœê·¸ ì œê±° (BeautifulSoup)
- íŠ¹ìˆ˜ë¬¸ìž ì •ê·œí™”
- ì–¸ì–´ ê°ì§€ (langdetect)

**Phase 2: í‚¤ì›Œë“œ ì¶”ì¶œ (í–¥í›„)**
- TF-IDF ê¸°ë°˜ í‚¤ì›Œë“œ ë„ì¶œ
- Named Entity Recognition (NER)
- í† í”½ ëª¨ë¸ë§ (LDA)

**Phase 3: ìš”ì•½ (í–¥í›„)**
- GPT-4o-mini ê¸°ë°˜ 3ì¤„ ìš”ì•½
- ê°ì • ë¶„ì„ (ê¸ì •/ë¶€ì •/ì¤‘ë¦½)
- ì¹´í…Œê³ ë¦¬ ìžë™ ë¶„ë¥˜

**ì• ìžì¼ ë°©ë²•ë¡  ì ìš©**:
- Sprint 1: ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- Sprint 2: í‚¤ì›Œë“œ ì¶”ì¶œ ì‹œìŠ¤í…œ
- Sprint 3: ìš”ì•½ ë° ë¶„ì„ ê¸°ëŠ¥

**ì—…ë¬´ ë²”ìœ„ ëª…í™•í™”**:
- **ë‚´ ì—­í• **: ë°ì´í„° ìˆ˜ì§‘ ì—ì´ì „íŠ¸ ê°œë°œ (í¬ë¡¤ë§ + í’ˆì§ˆ ê²€ì¦ + Self-Healing)
- **ë²”ìœ„ ì™¸**: ë¶„ì„/ì¸ì‚¬ì´íŠ¸ ë„ì¶œ (ë‹¤ë¥¸ íŒ€ ë‹´ë‹¹)
- **í™•ìž¥ì„± í™•ë³´**: ì „ì²˜ë¦¬/ìš”ì•½ ì›Œí¬í”Œë¡œìš° ì¸í„°íŽ˜ì´ìŠ¤ë§Œ ì„¤ê³„, ì‹¤ì œ êµ¬í˜„ì€ í•„ìš” ì‹œ ì¶”ê°€

---

## Reference

### ê¸°ìˆ  ì•„í‚¤í…ì²˜

**í”„ë¡œì íŠ¸ êµ¬ì¡°**:
```
crawlagent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ workflow/
â”‚   â”‚   â”œâ”€â”€ uc1_validation.py      # UC1: í’ˆì§ˆ ê²Œì´íŠ¸
â”‚   â”‚   â””â”€â”€ uc2_hitl.py             # UC2: Multi-Agent Selector ìƒì„±
â”‚   â”œâ”€â”€ scrapy_project/
â”‚   â”‚   â””â”€â”€ spiders/
â”‚   â”‚       â””â”€â”€ yonhap_spider.py    # ì—°í•©ë‰´ìŠ¤ í¬ë¡¤ëŸ¬
â”‚   â””â”€â”€ database/
â”‚       â””â”€â”€ models.py               # SQLAlchemy ëª¨ë¸
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ fetch_html_for_studio.py   # LangGraph Studio í…ŒìŠ¤íŠ¸ ìž…ë ¥ ìƒì„±
â”‚   â””â”€â”€ explain_studio_graph.py    # ì‹œê°í™” PNG ìƒì„±
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ uc2_explained.png           # UC2 ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ëž¨
â”‚   â””â”€â”€ uc1_vs_uc2_comparison.png   # ë¹„êµí‘œ
â”œâ”€â”€ langgraph.json                  # LangGraph Studio ì„¤ì •
â””â”€â”€ pyproject.toml                  # ì˜ì¡´ì„± ê´€ë¦¬
```

**ì£¼ìš” ì˜ì¡´ì„±**:
- Python 3.11+
- LangGraph 0.2.0+ (StateGraph)
- LangChain OpenAI 0.2.0+ (GPT-4o-mini)
- Google Generative AI 0.8.0+ (Gemini-2.0-flash-exp)
- Scrapy 2.11.0+ (í¬ë¡¤ë§)
- BeautifulSoup4 4.12.0+ (HTML íŒŒì‹±)
- SQLAlchemy 2.0.0+ (ORM)
- Gradio 4.0.0+ (UI)

**API í‚¤ ì„¤ì •** (`.env`):
```
OPENAI_API_KEY=sk-...
GEMINI_API_KEY=AI...
DATABASE_URL=postgresql://user:pass@localhost/crawlagent
```

---

### í˜„ìž¬ êµ¬í˜„ ìƒíƒœ

**ì™„ë£Œëœ ê¸°ëŠ¥**:
- âœ… UC1: GPT í’ˆì§ˆ ê²Œì´íŠ¸ (95ì  ìž„ê³„ê°’)
- âœ… UC2: Multi-Agent CSS Selector ìƒì„± (GPT + Gemini)
- âœ… LangGraph StateGraph êµ¬í˜„
- âœ… LangGraph Studio í†µí•©
- âœ… Scrapy Spider (ì—°í•©ë‰´ìŠ¤)
- âœ… PostgreSQL ìŠ¤í‚¤ë§ˆ ë° ì¤‘ë³µ ë°©ì§€
- âœ… Cloudflare Tunnel ì„¤ì •
- âœ… ì‹œê°í™” ìŠ¤í¬ë¦½íŠ¸ (PNG ìƒì„±)

**ë¯¸ì™„ë£Œ (TODO)**:
- â³ Gradio UI ê³ ë„í™” (í˜„ìž¬ ê¸°ë³¸ êµ¬í˜„ ì™„ë£Œ)
- â³ UC2 Human Review UI (ìžë™ ìŠ¹ì¸ìœ¼ë¡œ ìž„ì‹œ ì²˜ë¦¬)
- â³ UC1 â†’ UC2 ìžë™ ì—°ê³„ (HTML íŒŒì‹± ì‹¤íŒ¨ ê°ì§€ â†’ UC2 íŠ¸ë¦¬ê±°)
- â³ ë‹¤ì¤‘ ì†ŒìŠ¤ ì§€ì› (SNS, ë¸”ë¡œê·¸ Spider ì¶”ê°€)
- â³ ë‚ ì§œ ê¸°ë°˜ ìžë™ ì¤‘ë‹¨ ë¡œì§ (í˜„ìž¬ ìˆ˜ë™ `target_date` íŒŒë¼ë¯¸í„°)
- â³ SNS ë™ì  ë©”íŠ¸ë¦­ ì‹œê³„ì—´ ìˆ˜ì§‘
- â³ ìŠ¤ì¼€ì¤„ëŸ¬ í†µí•© (cron/APScheduler)
- â³ ìžì—°ì–´ ì¿¼ë¦¬ ì¸í„°íŽ˜ì´ìŠ¤ (Context Engineering)

---

### ì‹¤í–‰ ì˜ˆì‹œ

**1. ì—°í•©ë‰´ìŠ¤ í¬ë¡¤ë§ ì‹¤í–‰**:
```bash
cd /Users/charlee/Desktop/Intern/crawlagent
PYTHONPATH=/Users/charlee/Desktop/Intern/crawlagent poetry run scrapy crawl yonhap
```

**ì¶œë ¥**:
```
[UC1 Validation] Score: 98.5 (PASS) - Title, Body, Date all valid
[Pipeline] Article saved: "í•œêµ­ ê²½ì œ ì„±ìž¥ë¥  2.8% ì „ë§..."
```

**2. LangGraph Studioì—ì„œ UC2 í…ŒìŠ¤íŠ¸**:
```bash
# 1ë‹¨ê³„: HTML ìž…ë ¥ ìƒì„±
python scripts/fetch_html_for_studio.py "https://www.yna.co.kr/view/AKR20251105086500009"

# 2ë‹¨ê³„: LangGraph Studio ì‹¤í–‰
langgraph dev --tunnel

# 3ë‹¨ê³„: ë¸Œë¼ìš°ì €ì—ì„œ studio_input.json ë‚´ìš© ë³µì‚¬ â†’ Input ì°½ì— ë¶™ì—¬ë„£ê¸°
# 4ë‹¨ê³„: "Run" ë²„íŠ¼ í´ë¦­ â†’ ê° ë‹¨ê³„ë³„ State ë³€í™” í™•ì¸
```

**3. ì‹œê°í™” ìžë£Œ ìƒì„±**:
```bash
python scripts/explain_studio_graph.py
# â†’ docs/uc2_explained.png ìƒì„±
```

---

### í”„ë¡œì íŠ¸ ì„±ê³¼

**ê¸°ìˆ ì  ì„±ê³¼**:
- Multi-Agent í•©ì˜ ì‹œìŠ¤í…œ êµ¬í˜„ (GPT + Gemini êµì°¨ ê²€ì¦)
- LangGraph StateGraph ê¸°ë°˜ HITL íŒ¨í„´ ì ìš©
- í’ˆì§ˆ ê²Œì´íŠ¸ë¥¼ í†µí•œ ìžë™ ë°ì´í„° ê²€ì¦
- Self-Healing ë©”ì»¤ë‹ˆì¦˜ (HTML êµ¬ì¡° ë³€ê²½ ëŒ€ì‘)

**ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜**:
- í¬ë¡¤ëŸ¬ ìœ ì§€ë³´ìˆ˜ ì‹œê°„ 90% ê°ì†Œ (30ë¶„ â†’ 3ë¶„)
- ë°ì´í„° í’ˆì§ˆ í–¥ìƒ (95ì  ì´ìƒë§Œ ì €ìž¥)
- API ë¹„ìš© ì ˆê° (ì¤‘ë³µ ìˆ˜ì§‘ ë°©ì§€)
- í™•ìž¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜ (ë‹¤ì¤‘ ì‚¬ì´íŠ¸ ì¶”ê°€ ìš©ì´)

**í–¥í›„ í™œìš© ê³„íš**:
- **RAG íŒ€**: ë™ì  ìŠ¤í‚¤ë§ˆ ì¶”ì¶œì— UC2 ê°œë… ì ìš© (ë²•ë¥ /ì˜ë£Œ ë¬¸ì„œ)
- **ë§ˆì¼€íŒ…/ìžë™í™” íŒ€**: SNS ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° íŠ¸ë Œë“œ ë¶„ì„
- **í™•ìž¥ì„±**: ë‹¤ì¤‘ ì†ŒìŠ¤ ì§€ì›ìœ¼ë¡œ ë²”ìš© ë°ì´í„° ìˆ˜ì§‘ í”Œëž«í¼ìœ¼ë¡œ ë°œì „
- **ìžì—°ì–´ ì¸í„°íŽ˜ì´ìŠ¤**: ë¹„ê°œë°œìž(PM/ë¶„ì„ê°€)ë„ ë°ì´í„° ìš”ì²­ ê°€ëŠ¥

**ì—…ë¬´ ë²”ìœ„ ë° ì—­í• **:
- **ë‚´ ì—­í• **: ë°ì´í„° ìˆ˜ì§‘ ì—ì´ì „íŠ¸ ê°œë°œ (Self-Healing Multi-Agent System)
- **í•µì‹¬ ê¸°ìˆ **: Scrapy + LangGraph + Multi-Agent + HITL
- **ê´€ë¦¬ ë²”ìœ„**: í¬ë¡¤ëŸ¬ ìœ ì§€ë³´ìˆ˜, í™•ìž¥ì„± í™•ë³´, í’ˆì§ˆ ë³´ì¦
- **ë²”ìœ„ ì™¸**: ë¶„ì„/ì¸ì‚¬ì´íŠ¸ ë„ì¶œ (ë‹¤ë¥¸ íŒ€ í˜‘ì—…)

---

## Appendix: UC1 vs UC2 ë¹„êµ

| í•­ëª© | UC1 (Quality Gate) | UC2 (Selector Generation) |
|------|-------------------|---------------------------|
| **ëª©ì ** | ì¶”ì¶œ ê²°ê³¼ í’ˆì§ˆ ê²€ì¦ | CSS Selector ìžë™ ìƒì„± |
| **ìž…ë ¥** | `{title, body, date}` | `{url, html_content}` |
| **ì¶œë ¥** | `{score, is_valid, feedback}` | `{final_selectors}` |
| **LLM** | GPT-4o-mini ë‹¨ë… | GPT-4o-mini + Gemini-2.0-flash |
| **í”„ë ˆìž„ì›Œí¬** | ì¼ë°˜ Python í•¨ìˆ˜ | LangGraph StateGraph |
| **ì‹¤í–‰ ì‹œì ** | ë§¤ ê¸°ì‚¬ ì¶”ì¶œë§ˆë‹¤ | HTML êµ¬ì¡° ë³€ê²½ ê°ì§€ ì‹œ |
| **ì‹¤í–‰ ë¹ˆë„** | ë†’ìŒ (ìˆ˜ì²œ ê±´/ì¼) | ë‚®ìŒ (ìˆ˜ ê±´/ì›”) |
| **HITL** | ì—†ìŒ (ìžë™ íŒë‹¨) | 3íšŒ ìž¬ì‹œë„ ì‹¤íŒ¨ ì‹œ |
| **ì½”ë“œ ìœ„ì¹˜** | [uc1_validation.py](../src/workflow/uc1_validation.py) | [uc2_hitl.py](../src/workflow/uc2_hitl.py) |

**ì—°ê³„ ì‹œë‚˜ë¦¬ì˜¤** (í–¥í›„ êµ¬í˜„):
```
ê¸°ì‚¬ í¬ë¡¤ë§
  â†“
CSS Selectorë¡œ ì¶”ì¶œ
  â†“
UC1 ê²€ì¦ (í’ˆì§ˆ ê²Œì´íŠ¸)
  â†“
  â”œâ”€ Score >= 95 â†’ DB ì €ìž¥
  â””â”€ Score < 50 (3ê±´ ì—°ì†) â†’ UC2 íŠ¸ë¦¬ê±°
        â†“
      ìƒˆë¡œìš´ Selector ìƒì„±
        â†“
      Human Review ìŠ¹ì¸
        â†“
      Selector ì—…ë°ì´íŠ¸ â†’ ìž¬ì‹œìž‘
```

---

---

## í”„ë¡œì íŠ¸ ë¡œë“œë§µ

### Phase 1: í•µì‹¬ ê¸°ëŠ¥ êµ¬ì¶• (ì™„ë£Œ)
- âœ… ì—°í•©ë‰´ìŠ¤ í¬ë¡¤ëŸ¬ (Scrapy)
- âœ… UC1: GPT í’ˆì§ˆ ê²Œì´íŠ¸
- âœ… UC2: Multi-Agent CSS Selector ìžë™ ìƒì„±
- âœ… LangGraph StateGraph êµ¬í˜„
- âœ… PostgreSQL ìŠ¤í‚¤ë§ˆ ë° ì¤‘ë³µ ë°©ì§€
- âœ… Gradio UI ê¸°ë³¸ êµ¬í˜„

### Phase 2: í™•ìž¥ì„± ê°•í™” (ì§„í–‰ ì¤‘)
- ðŸ”„ ë‚ ì§œ ê¸°ë°˜ ìžë™ ì¤‘ë‹¨ ë¡œì§
- ðŸ”„ ë‹¤ì¤‘ ì†ŒìŠ¤ ì§€ì› (SNS, ë¸”ë¡œê·¸)
- ðŸ”„ ìŠ¤ì¼€ì¤„ëŸ¬ í†µí•© (cron/APScheduler)
- ðŸ”„ UC1 â†’ UC2 ìžë™ ì—°ê³„

### Phase 3: ê³ ë„í™” (í–¥í›„)
- ðŸ“… SNS ë™ì  ë©”íŠ¸ë¦­ ì‹œê³„ì—´ ìˆ˜ì§‘
- ðŸ“… ìžì—°ì–´ ì¿¼ë¦¬ ì¸í„°íŽ˜ì´ìŠ¤
- ðŸ“… ì „ì²˜ë¦¬ ë° ìš”ì•½ ì›Œí¬í”Œë¡œìš°
- ðŸ“… í‚¤ì›Œë“œ ì¶”ì¶œ ë° í† í”½ ëª¨ë¸ë§

### ì• ìžì¼ ìŠ¤í”„ë¦°íŠ¸ ê³„íš
- **Sprint 1 (2ì£¼)**: ë‚ ì§œ ê¸°ë°˜ ì¤‘ë‹¨ + ìŠ¤ì¼€ì¤„ëŸ¬
- **Sprint 2 (2ì£¼)**: Twitter/Facebook Spider ì¶”ê°€
- **Sprint 3 (2ì£¼)**: ìžì—°ì–´ ì¿¼ë¦¬ í”„ë¡œí† íƒ€ìž…

---

## ê¸°ìˆ  ìŠ¤íƒ ì„ ì • ì´ìœ 

### LangGraph ì„ íƒ ì´ìœ 
- **State ê´€ë¦¬**: Multi-Agent ê°„ ë°ì´í„° ê³µìœ ê°€ ëª…í™•
- **HITL ì§€ì›**: Human-in-the-Loop íŒ¨í„´ ê¸°ë³¸ ì œê³µ
- **ì‹œê°í™”**: LangGraph Studioë¡œ ì›Œí¬í”Œë¡œìš° ë””ë²„ê¹… ìš©ì´
- **í™•ìž¥ì„±**: ìƒˆë¡œìš´ Agent ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”

### GPT-4o-mini + Gemini-2.0-flash ì¡°í•©
- **ë¹„ìš© íš¨ìœ¨**: GPT-4o-miniëŠ” GPT-4 ëŒ€ë¹„ 15ë°° ì €ë ´
- **êµì°¨ ê²€ì¦**: ë‘ ëª¨ë¸ì˜ í•©ì˜ë¡œ hallucination ë°©ì§€
- **ì†ë„**: í’ˆì§ˆ ê²Œì´íŠ¸ëŠ” ë¹ ë¥¸ ì‘ë‹µ í•„ìš” (GPT-4o-mini 1ì´ˆ ë‚´)
- **ì •í™•ë„**: Geminiì˜ ì‹¤ì œ í…ŒìŠ¤íŠ¸ë¡œ Selector ì •í™•ë„ ë³´ìž¥

### Scrapy vs BeautifulSoup
- **ì„±ëŠ¥**: ScrapyëŠ” ë¹„ë™ê¸° í¬ë¡¤ë§ìœ¼ë¡œ 10ë°° ë¹ ë¦„
- **í™•ìž¥ì„±**: Pipeline ì•„í‚¤í…ì²˜ë¡œ ì „ì²˜ë¦¬/ì €ìž¥ ë¶„ë¦¬
- **ìœ ì§€ë³´ìˆ˜**: Middlewareë¡œ ê³µí†µ ë¡œì§ ìž¬ì‚¬ìš©
- **ëª¨ë‹ˆí„°ë§**: ë‚´ìž¥ í†µê³„ ë° ë¡œê·¸ ì‹œìŠ¤í…œ

---

## Reference: ì‹¤ì œ ìžë£Œ

### ë‰´ìŠ¤ í¬ë¡¤ë§ ì°¸ê³  ìžë£Œ
- [Scrapy ê³µì‹ ë¬¸ì„œ](https://docs.scrapy.org/)
- [LangGraph ê³µì‹ ë¬¸ì„œ](https://langchain-ai.github.io/langgraph/)
- [ì—°í•©ë‰´ìŠ¤ ë¡œë´‡ ë°°ì œ í‘œì¤€](https://www.yna.co.kr/robots.txt)

### Multi-Agent ì‹œìŠ¤í…œ ì°¸ê³  ë…¼ë¬¸
- "Constitutional AI: Harmlessness from AI Feedback" (Anthropic, 2022)
- "RLAIF: Reinforcement Learning from AI Feedback" (Google, 2023)

### ì• ìžì¼ ë°©ë²•ë¡ 
- Scrum Guide 2020
- Sprint Planning Best Practices

---

**ë¬¸ì„œ ìž‘ì„±ì¼**: 2025-11-06
**ìž‘ì„±ìž**: AI ì—ì´ì „íŠ¸ ì—°êµ¬ ê°œë°œìž
**ë²„ì „**: 2.0 (ë²”ìš© ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œìœ¼ë¡œ í™•ìž¥)
**ì—…ë°ì´íŠ¸**: í™•ìž¥ì„±, ì—…ë¬´ ë²”ìœ„, ë¡œë“œë§µ ì¶”ê°€
